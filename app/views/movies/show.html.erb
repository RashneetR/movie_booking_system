<%= will_paginate @shows %>
<script>
  function calc_total_cost(ele) {
  var x = $(ele).closest('#movie_show_row').find('input.ticket_temp').val();
  $(ele).closest('#movie_show_row').find('input.total_cost').val($(ele).val()*x);
}
</script>
<h1>Movies</h1>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <td><%= @movie.name %></td>
    </tr>
    <tr>
      <th>Summary</th>
      <td><%= @movie.summary %></td>
    </tr>
  </thead>
  <% if @movie.status == "Now Showing" %>
    <% if @shows.any? %>
      <table>
        <thead>
          <tr>
            <th>Theatre Name</th>
            <th>Start Time</th>
            <th>End Time</th>
            <th>Cost per Seat</th>
            <th>Number of seats</th>
            <th>Total Cost</th>
          </tr>
        </thead>
        <tbody>
          <% @shows.each do |show| %>
            <tr id="movie_show_row">
              <% if show.booking_state == "vacant" %>
                <%= form_for(:ticket, :url => url_for(action: 'create', controller:'tickets')) do |f| %>
                  <%= f.hidden_field :show_id, value: show.id %>
                  <%= f.hidden_field :user_id, value: current_user.id %>
                  <td><%= show.theatre.name %></td>
                  <td><%= show.start_time %></td>
                  <td><%= show.end_time %></td>
                  <td><%= f.number_field :temp, class: "ticket_temp", value:show.cost_per_seat, readonly: true %></td>
                  <td><%= f.number_field(:num_seats_bought, min: 1 , max: (show.total_seats - show.num_seats_sold), step: 1, onchange: "calc_total_cost(this)") %>
                  <td><%= f.text_field :total_cost, class: "total_cost", readonly: true %></td>
                  <td>
                    <div class="actions">
                      <td><%= f.submit "Book Tickets", class: "submit_btn" %></td>
                    </div>
                  </td>
                <% end %>
              <% end %>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <br />
      <p> No shows yet </p>
    <% end %>
  <% end %>
</table>
<%= link_to 'Back', movies_path %>
<%= will_paginate @shows %>